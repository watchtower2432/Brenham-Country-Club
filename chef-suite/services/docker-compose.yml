version: '3.8'

services:
  # PostgreSQL Database
  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: chef_suite
      POSTGRES_USER: chef_user
      POSTGRES_PASSWORD: secure_password_2025
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "5432:5432"
    restart: unless-stopped

  # Tandoor Recipes
  tandoor:
    image: vabene1111/recipes:latest
    environment:
      SECRET_KEY: your_secret_key_here
      DB_ENGINE: django.db.backends.postgresql
      POSTGRES_HOST: postgres
      POSTGRES_PORT: 5432
      POSTGRES_USER: chef_user
      POSTGRES_PASSWORD: secure_password_2025
      POSTGRES_DB: chef_suite
    volumes:
      - tandoor_media:/opt/recipes/media
      - tandoor_static:/opt/recipes/staticfiles
    ports:
      - "8080:8080"
    depends_on:
      - postgres
    restart: unless-stopped

  # Grocy Inventory Management
  grocy:
    image: linuxserver/grocy:latest
    environment:
      PUID: 1000
      PGID: 1000
      TZ: America/Chicago
    volumes:
      - grocy_config:/config
    ports:
      - "9283:80"
    restart: unless-stopped

  # Metabase Analytics
  metabase:
    image: metabase/metabase:latest
    environment:
      MB_DB_TYPE: postgres
      MB_DB_DBNAME: chef_suite
      MB_DB_PORT: 5432
      MB_DB_USER: chef_user
      MB_DB_PASS: secure_password_2025
      MB_DB_HOST: postgres
    volumes:
      - metabase_data:/metabase-data
    ports:
      - "3000:3000"
    depends_on:
      - postgres
    restart: unless-stopped

  # NGINX Reverse Proxy
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - ./ssl:/etc/ssl/certs:ro
    depends_on:
      - tandoor
      - grocy
      - metabase
    restart: unless-stopped

volumes:
  postgres_data:
  tandoor_media:
  tandoor_static:
  grocy_config:
  metabase_data: